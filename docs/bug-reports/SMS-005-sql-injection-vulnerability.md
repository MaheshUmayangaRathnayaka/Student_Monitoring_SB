# JIRA BUG REPORT: SMS-005

## BASIC INFORMATION
- **Bug ID:** SMS-005
- **Title:** [Security] SQL injection vulnerability in student search functionality
- **Date Reported:** October 2, 2025
- **Reporter:** Security Team
- **Assignee:** Backend Development Team
- **Watchers:** Security Team, Product Owner, DevOps Team

## CLASSIFICATION
- **Project:** Student Monitoring System (SMS)
- **Issue Type:** Bug
- **Priority:** Critical
- **Severity:** Critical
- **Component:** Search/Security
- **Category:** Security Vulnerability
- **Affects Version:** 3.1.5
- **Labels:** security, sql-injection, search, critical-vulnerability

## ENVIRONMENT DETAILS
- **Operating System:** Windows 11 Pro (Version 22H2)
- **Browser:** Chrome 118.0.5993.88 (64-bit)
- **Java Version:** OpenJDK 17.0.12
- **Spring Boot Version:** 3.1.5
- **Database:** H2 in-memory database
- **Test Environment:** http://localhost:8080
- **Network:** Local development environment

## BUG DESCRIPTION

### **Summary:**
The student search API endpoint is vulnerable to SQL injection attacks, allowing malicious users to execute arbitrary SQL commands through the search parameter.

### **Detailed Description:**
The `/api/students/search` endpoint directly concatenates user input into SQL queries without proper sanitization or parameterization. This critical security flaw allows attackers to inject malicious SQL code that could:
- Extract sensitive data from the database
- Drop or modify database tables
- Bypass authentication and authorization
- Potentially gain system-level access

### **Business Impact:**
- **Data Breach Risk:** Sensitive student information could be stolen
- **Data Loss:** Database tables could be deleted or corrupted
- **Compliance Violations:** GDPR, FERPA, and other privacy regulations
- **Reputation Damage:** Security breach could damage institutional trust
- **Legal Liability:** Potential lawsuits from affected students/parents

## REPRODUCTION STEPS

### **Prerequisites:**
1. Application must be running (http://localhost:8080)
2. Student data should be present in database

### **Step-by-Step Reproduction:**

1. **Start the application:**
   ```bash
   cd C:\Users\usr\Desktop\Smon\Student_Monitoring_SB
   .\mvnw spring-boot:run
   ```

2. **Test SQL injection via browser:**
   ```
   Navigate to: http://localhost:8080/api/students/search?query=test'; DROP TABLE students; --
   ```

3. **Test via curl command:**
   ```bash
   curl "http://localhost:8080/api/students/search?query=test%27%3B%20DROP%20TABLE%20students%3B%20--"
   ```

4. **Test via browser console:**
   ```javascript
   fetch('/api/students/search?query=test\'; DROP TABLE students; --')
     .then(response => response.json())
     .then(data => console.log(data));
   ```

5. **Check application logs for security alerts**

### **Additional Test Cases:**
- **Data Extraction:** `query=' UNION SELECT username,password FROM users; --`
- **Information Disclosure:** `query=' AND 1=1; --`
- **Error-based Injection:** `query=' AND (SELECT 1 FROM (SELECT COUNT(*),CONCAT(VERSION(),FLOOR(RAND(0)*2))x FROM information_schema.tables GROUP BY x)a); --`

## EXPECTED vs ACTUAL RESULTS

### **Expected Result:**
- Input should be sanitized and parameterized
- No SQL errors should be logged
- Search should return filtered results or empty set
- No security warnings should appear
- Database should remain intact and secure

### **Actual Result:**
- Console shows: "⚠️ SECURITY ALERT: Potential SQL injection detected"
- Application logs dangerous SQL query construction
- System attempts to execute malicious SQL commands
- Error messages reveal database structure
- Potential for data loss or theft

## TECHNICAL DETAILS

### **Vulnerable Code Location:**
**File:** `StudentServiceImpl.java` (line ~85)
```java
// CRITICAL SECURITY FLAW: Direct string concatenation in SQL
public List<StudentDTO> searchStudentsVulnerable(String query) {
    System.out.println("EXECUTING VULNERABLE SQL: SELECT * FROM students WHERE first_name LIKE '%" + query + "%'");
    // This allows SQL injection attacks
}
```

### **Attack Vector:**
Direct string concatenation in SQL query construction without input validation or parameterization.

### **Error Messages Observed:**
```
⚠️ SECURITY ALERT: Potential SQL injection detected in query: test'; DROP TABLE students; --
⚠️ In a real system, this could: DROP TABLES, DELETE DATA, STEAL INFORMATION!
```

### **Application Logs:**
```
2025-10-02 14:30:15.123 INFO 1234 --- [nio-8080-exec-1] 
EXECUTING VULNERABLE SQL: SELECT * FROM students WHERE first_name LIKE '%test'; DROP TABLE students; --%'

2025-10-02 14:30:15.124 ERROR 1234 --- [nio-8080-exec-1] 
⚠️ SECURITY ALERT: Potential SQL injection detected in query: test'; DROP TABLE students; --
```

### **Security Analysis:**
- **OWASP Top 10:** A03:2021 – Injection
- **CWE Classification:** CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')
- **CVSS Score:** 9.8 (Critical)

## SUGGESTED FIX

### **Immediate Actions (Critical - Fix within 24 hours):**
1. **Replace vulnerable method with parameterized queries:**
```java
public List<StudentDTO> searchStudents(String query) {
    // Use JPA with parameterized queries
    List<Student> students = studentRepository.findByFirstNameContainingIgnoreCaseOrLastNameContainingIgnoreCase(query, query);
    return students.stream().map(this::mapToDto).toList();
}
```

2. **Add input validation:**
```java
public List<StudentDTO> searchStudents(String query) {
    // Validate input
    if (query == null || query.trim().isEmpty()) {
        throw new IllegalArgumentException("Search query cannot be empty");
    }
    
    // Sanitize input (remove special SQL characters)
    String sanitizedQuery = query.replaceAll("[';\"\\-\\-]", "");
    
    // Use safe JPA query
    return studentRepository.findBySearchTerm(sanitizedQuery);
}
```

3. **Update repository with safe method:**
```java
@Repository
public interface StudentRepository extends JpaRepository<Student, Long> {
    @Query("SELECT s FROM Student s WHERE LOWER(s.firstName) LIKE LOWER(CONCAT('%', :searchTerm, '%')) OR LOWER(s.lastName) LIKE LOWER(CONCAT('%', :searchTerm, '%'))")
    List<Student> findBySearchTerm(@Param("searchTerm") String searchTerm);
}
```

## TEST SCENARIOS FOR VERIFICATION

### **Security Test Cases:**
```java
@Test
void testSqlInjectionPrevention() {
    String[] maliciousInputs = {
        "test'; DROP TABLE students; --",
        "' UNION SELECT * FROM users; --",
        "'; DELETE FROM students WHERE 1=1; --",
        "' OR '1'='1",
        "admin'--",
        "'; SHUTDOWN; --"
    };
    
    for (String maliciousInput : maliciousInputs) {
        // Should not cause SQL errors or security issues
        assertDoesNotThrow(() -> {
            List<StudentDTO> results = studentService.searchStudents(maliciousInput);
            // Results should be empty or filtered safely
        });
    }
}
```

## ATTACHMENTS

1. **Screenshots:**
   - `sql-injection-browser-test.png` - Browser test showing vulnerability
   - `console-security-alert.png` - Browser console security warnings
   - `application-logs-sql-injection.png` - Server logs showing dangerous queries

2. **Security Reports:**
   - `sql-injection-vulnerability-scan.pdf` - Automated security scan results
   - `penetration-test-results.txt` - Manual penetration testing findings

3. **Code Analysis:**
   - `vulnerable-code-snippet.txt` - Highlighted vulnerable code sections
   - `recommended-fix-implementation.java` - Secure code implementation

## ADDITIONAL INFORMATION

### **Frequency:**
- **Always reproducible** with any SQL injection payload
- **Affects all search operations** using the vulnerable endpoint
- **Critical security window** exists until patched

### **Related Security Issues:**
- Review all other endpoints for similar vulnerabilities
- Audit all database query implementations
- Implement security scanning in CI/CD pipeline
- Add Web Application Firewall (WAF) rules

### **Compliance Requirements:**
- **Immediate disclosure** to security team required
- **Regulatory notification** may be needed if data is compromised
- **Security audit** of entire application recommended

### **Prevention Measures:**
- Implement static code analysis for SQL injection detection
- Add security-focused code review checklist
- Regular penetration testing
- Developer security training on secure coding practices

## ACCEPTANCE CRITERIA

### **Definition of Done:**
- [ ] Vulnerable code replaced with parameterized queries
- [ ] Input validation implemented for all search parameters
- [ ] All SQL injection test cases pass
- [ ] No SQL errors or security warnings in logs
- [ ] Security scan shows no SQL injection vulnerabilities
- [ ] Penetration test confirms fix is effective
- [ ] Documentation updated with secure coding guidelines

### **Verification Steps:**
1. Deploy fix to test environment
2. Run comprehensive SQL injection test suite
3. Perform manual penetration testing
4. Execute automated security scanning
5. Verify all search functionality still works correctly
6. Confirm no performance degradation
7. Update security documentation

---

**Security Team Notes:**
This is a critical security vulnerability that requires immediate attention. All development and testing should be halted until this issue is resolved. Consider taking the search functionality offline if fix cannot be deployed within 24 hours.

**Severity Justification:**
Critical priority due to potential for complete system compromise, data theft, and regulatory compliance violations. This vulnerability could result in significant financial and reputational damage to the organization.